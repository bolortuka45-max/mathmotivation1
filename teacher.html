<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>–ë–∞–≥—à–∏–π–Ω —Ö—è–Ω–∞–ª—Ç—ã–Ω —Å–∞–º–±–∞—Ä</title>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .header { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stats-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .stats-card h3 { margin-top: 0; color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
    th { background-color: #f8f9fa; font-weight: bold; }
    .score-high { color: #27ae60; font-weight: bold; }
    .score-medium { color: #f39c12; }
    .score-low { color: #e74c3c; }
    .export-btn { background-color: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
    .export-btn:hover { background-color: #1976D2; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìä –ë–∞–≥—à–∏–π–Ω —Ö—è–Ω–∞–ª—Ç—ã–Ω —Å–∞–º–±–∞—Ä</h1>
    <p>–°—É—Ä–∞–≥—á–¥—ã–Ω –∏—Ä—Ü –±–æ–ª–æ–Ω “Ø–Ω—ç–ª–≥—ç—ç–Ω–∏–π –º—ç–¥—ç—ç–ª—ç–ª</p>
  </div>

  <div class="stats-grid">
    <div class="stats-card">
      <h3>üìà –ï—Ä”©–Ω—Ö–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫</h3>
      <div id="generalStats">
        <p><strong>–ù–∏–π—Ç —Å—É—Ä–∞–≥—á:</strong> <span id="totalStudents">0</span></p>
        <p><strong>”®–Ω”©”©–¥”©—Ä –∏—Ä—Å—ç–Ω:</strong> <span id="todayAttendance">0</span></p>
        <p><strong>–ò—Ä—Ü–∏–π–Ω —Ö—É–≤—å:</strong> <span id="attendanceRate">0%</span></p>
      </div>
    </div>

    <div class="stats-card">
      <h3>üéØ –ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –¥—É–Ω–¥–∞–∂ –æ–Ω–æ–æ</h3>
      <div id="averageScores"></div>
    </div>
  </div>

  <div class="stats-card">
    <h3>üë• –°—É—Ä–∞–≥—á–¥—ã–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª—ç–ª</h3>
    <button class="export-btn" onclick="exportToCSV()">üì• CSV —Ç–∞—Ç–∞—Ö</button>
    <button class="export-btn" onclick="exportToJSON()">üì• JSON —Ç–∞—Ç–∞—Ö</button>
    
    <table id="studentTable">
      <thead>
        <tr>
          <th>–°—É—Ä–∞–≥—á–∏–π–Ω –Ω—ç—Ä</th>
          <th>–ö–æ–¥</th>
          <th>–ò—Ä—Ü</th>
          <th>–ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ü–∞–≥</th>
          <th>–ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –æ–Ω–æ–æ</th>
          <th>–¢”©–ª”©–≤</th>
        </tr>
      </thead>
      <tbody id="studentTableBody">
      </tbody>
    </table>
  </div>
</div>

<script>
  // –°—É—Ä–∞–≥—á–¥—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª
  const studentsData = [
    { name: "–•.–ê–º–∞—Ä–±–∞—è—Å–≥–∞–ª–∞–Ω", code: "1011" },
    { name: "–¢.–ë–∞—Ä—Ö–∞—Å–±–∞—è—Ä", code: "2319" },
    { name: "–ì.–ú–∏—á–∏–¥–º–∞–∞", code: "2205" },
    { name: "–≠.–≠—Ä–¥—ç–Ω—ç—Ç—É–Ω–≥–∞–ª–∞–≥", code: "1228" },
    { name: "–≠.–ë–∏–ª–≥“Ø“Ø–Ω–±–∞—è—Ä", code: "2818" },
    { name: "–ë.–≠–Ω—Ö–∑–∞—è–∞", code: "3005" },
    { name: "–ë.–≠—Ä—Ö—ç—Å", code: "1043" },
    { name: "–ë.–¶—ç–ª–º—ç–≥", code: "0618" },
    { name: "–ì.–¢—ç–º“Ø“Ø–ª—ç–Ω", code: "0315" },
    { name: "–°.–•–∞–ª–∏—É–Ω–∞–∞", code: "2225" },
    { name: "–¢.–î–∞–≤–∞–∞–±–∞–∞—Ç–∞—Ä", code: "1117" },
    { name: "–ê.–≠–Ω—Ö–∑—É–ª", code: "0421" },
    { name: "”®.–•“Ø—Å–ª—ç–Ω–±–∞—è—Ä", code: "0376" },
    { name: "–•.–ë–∞–¥–∞—Ä-–£—É–≥–∞–Ω", code: "0816" },
    { name: "–ù.–ù–∞–Ω–¥–∏–Ω-–≠—Ä–¥—ç–Ω—ç", code: "2106" },
    { name: "–ë.–ë–∞—Ç—Ü—ç—Ü—ç–≥", code: "0147" }
  ];

  // Firebase –∫–æ–Ω—Ñ–∏–≥: ”©”©—Ä–∏–π–Ω—Ö”©”© –ø—Ä–æ–µ–∫—Ç—ã–Ω config-–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Dashboard update
  function updateDashboard(attendanceData={}, scoresData={}) {
    // –ï—Ä”©–Ω—Ö–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫
    const totalStudents = studentsData.length;
    const todayAttendance = Object.keys(attendanceData).length;
    const attendanceRate = totalStudents > 0 ? Math.round((todayAttendance / totalStudents) * 100) : 0;
    document.getElementById('totalStudents').textContent = totalStudents;
    document.getElementById('todayAttendance').textContent = todayAttendance;
    document.getElementById('attendanceRate').textContent = attendanceRate + '%';

    // –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ö“Ø—Å–Ω—ç–≥—Ç
    const tbody = document.getElementById('studentTableBody');
    tbody.innerHTML = '';
    studentsData.forEach(student => {
      const isPresent = attendanceData[student.code];
      const score = scoresData[student.code] || 0;

      let scoreClass = 'score-low';
      if(score >= 80) scoreClass = 'score-high';
      else if(score >= 60) scoreClass = 'score-medium';

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${student.name}</td>
        <td>${student.code}</td>
        <td>${isPresent ? '‚úÖ –ò—Ä—Å—ç–Ω' : '‚ùå –ò—Ä—ç—ç–≥“Ø–π'}</td>
        <td>${isPresent || '-'}</td>
        <td class="${scoreClass}">${score}%</td>
        <td>${getStatus(isPresent, score)}</td>
      `;
      tbody.appendChild(row);
    });

    // –î—É–Ω–¥–∞–∂ –æ–Ω–æ–æ
    const scores = Object.values(scoresData);
    const average = scores.length > 0 ? Math.round(scores.reduce((a,b)=>a+b,0)/scores.length) : 0;
    const maxScore = scores.length > 0 ? Math.max(...scores) : 0;
    const minScore = scores.length > 0 ? Math.min(...scores) : 0;
    document.getElementById('averageScores').innerHTML = `
      <p><strong>–î—É–Ω–¥–∞–∂ –æ–Ω–æ–æ:</strong> ${average}%</p>
      <p><strong>–•–∞–º–≥–∏–π–Ω ”©–Ω–¥”©—Ä:</strong> ${maxScore}%</p>
      <p><strong>–•–∞–º–≥–∏–π–Ω –±–∞–≥–∞:</strong> ${minScore}%</p>
    `;
  }

  function getStatus(isPresent, score) {
    if(!isPresent) return 'üî¥ –•–∏—á—ç—ç–ª–¥ –æ—Ä–æ–æ–≥“Ø–π';
    if(score >= 80) return 'üü¢ –ú–∞—à —Å–∞–π–Ω';
    if(score >= 60) return 'üü° –°–∞–π–Ω';
    return 'üî¥ –ê–Ω—Ö–∞–∞—Ä–∞–ª —Ö—ç—Ä—ç–≥—Ç—ç–π';
  }

  // Firebase-—ç—ç—Å realtime update
  db.ref('attendance').on('value', snap => {
    const attendanceData = snap.val() || {};
    db.ref('scores').once('value', snap2 => {
      const scoresData = snap2.val() || {};
      updateDashboard(attendanceData, scoresData);
    });
  });

  // Export functions
  function exportToCSV() {
    db.ref('attendance').once('value', snapA => {
      const attendanceData = snapA.val() || {};
      db.ref('scores').once('value', snapS => {
        const scoresData = snapS.val() || {};
        let csv = "–°—É—Ä–∞–≥—á–∏–π–Ω –Ω—ç—Ä,–ö–æ–¥,–ò—Ä—Ü,–ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ü–∞–≥,–ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –æ–Ω–æ–æ,–¢”©–ª”©–≤\n";
        studentsData.forEach(s => {
          const isPresent = attendanceData[s.code];
          const score = scoresData[s.code] || 0;
          csv += `"${s.name}","${s.code}","${isPresent ? '–ò—Ä—Å—ç–Ω':'–ò—Ä—ç—ç–≥“Ø–π'}","${isPresent||'-'}","${score}%","${getStatus(isPresent,score)}"\n`;
        });
        const blob = new Blob([csv], {type: 'text/csv'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `student_report_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
      });
    });
  }

  function exportToJSON() {
    db.ref('attendance').once('value', snapA => {
      const attendanceData = snapA.val() || {};
      db.ref('scores').once('value', snapS => {
        const scoresData = snapS.val() || {};
        const report = {date: new Date(), students: studentsData.map(s=>({
          name: s.name, code: s.code, present: !!attendanceData[s.code],
          loginTime: attendanceData[s.code]||null, score: scoresData[s.code]||0,
          status: getStatus(attendanceData[s.code], scoresData[s.code]||0)
        }))};
        const blob = new Blob([JSON.stringify(report,null,2)], {type:'application/json'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `student_report_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
      });
    });
  }

</script>
</body>
</html>
