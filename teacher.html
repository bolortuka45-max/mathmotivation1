<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>Realtime Attendance & Scores</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js";

    // Firebase —Ç–æ—Ö–∏—Ä–≥–æ–æ
    const firebaseConfig = {
      apiKey: "AIzaSyAmxVtMKNhljn1ITsoNRPvpYudivEFRyJw",
      authDomain: "mathmotivation-95bfd.firebaseapp.com",
      databaseURL: "https://mathmotivation-95bfd-default-rtdb.firebaseio.com/",
      projectId: "mathmotivation-95bfd",
      storageBucket: "mathmotivation-95bfd.appspot.com",
      messagingSenderId: "727534124610",
      appId: "1:727534124610:web:32f4b7ef3d646ea49f77db"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // –ì–ª–æ–±–∞–ª —Ö—É–≤—å—Å–∞–≥—á
    window.attendanceData = {};
    window.scoresData = {};

    // Realtime listener
    const attendanceRef = ref(db, 'attendanceData');
    onValue(attendanceRef, snapshot => {
      window.attendanceData = snapshot.val() || {};
      if(window.updateDashboard) window.updateDashboard();
    });

    const scoresRef = ref(db, 'scoresData');
    onValue(scoresRef, snapshot => {
      window.scoresData = snapshot.val() || {};
      if(window.updateDashboard) window.updateDashboard();
    });

    // Student list
    const studentsData = [
      { "name": "–•.–ê–º–∞—Ä–±–∞—è—Å–≥–∞–ª–∞–Ω", "code": "1011" },
      { "name": "–¢.–ë–∞—Ä—Ö–∞—Å–±–∞—è—Ä", "code": "2319" },
      { "name": "–ì.–ú–∏—á–∏–¥–º–∞–∞", "code": "2205" }
    ];

    function getStudentStatus(isPresent, score){
      if(!isPresent) return 'üî¥ –•–∏—á—ç—ç–ª–¥ –æ—Ä–æ–æ–≥“Ø–π';
      if(score >= 80) return 'üü¢ –ú–∞—à —Å–∞–π–Ω';
      if(score >= 60) return 'üü° –°–∞–π–Ω';
      return 'üî¥ –ê–Ω—Ö–∞–∞—Ä–∞–ª —Ö—ç—Ä—ç–≥—Ç—ç–π';
    }

    function updateDashboard() {
      const tbody = document.getElementById('studentTableBody');
      tbody.innerHTML = '';
      studentsData.forEach(student => {
        const isPresent = !!window.attendanceData[student.code];
        const loginTime = window.attendanceData[student.code] || '-';
        const score = window.scoresData[student.code] || 0;

        let scoreClass = 'score-low';
        if(score >= 80) scoreClass = 'score-high';
        else if(score >= 60) scoreClass = 'score-medium';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.code}</td>
          <td>${isPresent ? '‚úÖ –ò—Ä—Å—ç–Ω' : '‚ùå –ò—Ä—ç—ç–≥“Ø–π'}</td>
          <td>${loginTime}</td>
          <td class="${scoreClass}">${score}%</td>
          <td>${getStudentStatus(isPresent, score)}</td>
        `;
        tbody.appendChild(row);
      });
    }

    window.updateDashboard = updateDashboard;
  </script>

  <style>
    body { font-family: Arial; margin:20px; background:#f4f4f4; }
    .container { max-width:1200px; margin:auto; background:white; padding:20px; border-radius:10px; }
    .header { background:#4CAF50; color:white; padding:15px; border-radius:8px; text-align:center; margin-bottom:20px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#f8f9fa; }
    .score-high { color:#27ae60; font-weight:bold; }
    .score-medium { color:#f39c12; }
    .score-low { color:#e74c3c; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><h1>üìä –ë–∞–≥—à–∏–π–Ω —Ö—è–Ω–∞–ª—Ç—ã–Ω —Å–∞–º–±–∞—Ä</h1></div>

    <!-- Student Table -->
    <table>
      <thead>
        <tr>
          <th>–°—É—Ä–∞–≥—á–∏–π–Ω –Ω—ç—Ä</th>
          <th>–ö–æ–¥</th>
          <th>–ò—Ä—Ü</th>
          <th>–ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ü–∞–≥</th>
          <th>–ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –æ–Ω–æ–æ</th>
          <th>–¢”©–ª”©–≤</th>
        </tr>
      </thead>
      <tbody id="studentTableBody"></tbody>
    </table>

    <!-- Student Login -->
    <h3>–°—É—Ä–∞–≥—á –Ω—ç–≤—Ç—Ä—ç—Ö</h3>
    <input type="text" id="studentCode" placeholder="–°—É—Ä–∞–≥—á–∏–π–Ω –∫–æ–¥">
    <button onclick="studentLogin()">–ù—ç–≤—Ç—Ä—ç—Ö</button>

    <script type="module">
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js";
      const db = getDatabase();

      function studentLogin() {
        const code = document.getElementById('studentCode').value.trim();
        if(!code) return alert('–ö–æ–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É');

        const now = new Date();
        const timeString = now.getHours().toString().padStart(2,'0') + ':' +
                           now.getMinutes().toString().padStart(2,'0');

        set(ref(db, 'attendanceData/' + code), timeString)
          .then(()=> alert('–ê–º–∂–∏–ª—Ç—Ç–∞–π –Ω—ç–≤—Ç—ç—Ä–ª—ç—ç!'))
          .catch(err=> alert('–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: ' + err));
      }

      window.studentLogin = studentLogin;
    </script>
  </div>

  <script>
    // First render
    updateDashboard();
  </script>
</body>
</html>
