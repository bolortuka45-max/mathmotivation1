<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>–ë–∞–≥—à–∏–π–Ω —Ö—è–Ω–∞–ª—Ç—ã–Ω —Å–∞–º–±–∞—Ä</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stats-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .stats-card h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .score-high { color: #27ae60; font-weight: bold; }
    .score-medium { color: #f39c12; }
    .score-low { color: #e74c3c; }
    .export-btn {
      background-color: #2196F3;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
    }
    .export-btn:hover {
      background-color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä –ë–∞–≥—à–∏–π–Ω —Ö—è–Ω–∞–ª—Ç—ã–Ω —Å–∞–º–±–∞—Ä</h1>
      <p>–°—É—Ä–∞–≥—á–¥—ã–Ω –∏—Ä—Ü –±–æ–ª–æ–Ω “Ø–Ω—ç–ª–≥—ç—ç–Ω–∏–π –º—ç–¥—ç—ç–ª—ç–ª</p>
    </div>

    <div class="stats-grid">
      <div class="stats-card">
        <h3>üìà –ï—Ä”©–Ω—Ö–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫</h3>
        <div id="generalStats">
          <p><strong>–ù–∏–π—Ç —Å—É—Ä–∞–≥—á:</strong> <span id="totalStudents">0</span></p>
          <p><strong>”®–Ω”©”©–¥”©—Ä –∏—Ä—Å—ç–Ω:</strong> <span id="todayAttendance">0</span></p>
          <p><strong>–ò—Ä—Ü–∏–π–Ω —Ö—É–≤—å:</strong> <span id="attendanceRate">0%</span></p>
        </div>
      </div>

      <div class="stats-card">
        <h3>üéØ –ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –¥—É–Ω–¥–∞–∂ –æ–Ω–æ–æ</h3>
        <div id="averageScores"></div>
      </div>
    </div>

    <div class="stats-card">
      <h3>üë• –°—É—Ä–∞–≥—á–¥—ã–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª—ç–ª</h3>
      <button class="export-btn" onclick="exportToCSV()">üì• CSV —Ç–∞—Ç–∞—Ö</button>
      <button class="export-btn" onclick="exportToJSON()">üì• JSON —Ç–∞—Ç–∞—Ö</button>
      
      <table id="studentTable">
        <thead>
          <tr>
            <th>–°—É—Ä–∞–≥—á–∏–π–Ω –Ω—ç—Ä</th>
            <th>–ö–æ–¥</th>
            <th>–ò—Ä—Ü</th>
            <th>–ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ü–∞–≥</th>
            <th>–ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –æ–Ω–æ–æ</th>
            <th>–¢”©–ª”©–≤</th>
          </tr>
        </thead>
        <tbody id="studentTableBody">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // –°—É—Ä–∞–≥—á–¥—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª —ç–Ω–¥ —à—É—É–¥ –±–∞–π–Ω–∞
    let studentsData = [
      { "name": "–•.–ê–º–∞—Ä–±–∞—è—Å–≥–∞–ª–∞–Ω", "code": "1011" },
      { "name": "–¢.–ë–∞—Ä—Ö–∞—Å–±–∞—è—Ä", "code": "2319" },
      { "name": "–ì.–ú–∏—á–∏–¥–º–∞–∞", "code": "2205" },
      { "name": "–≠.–≠—Ä–¥—ç–Ω—ç—Ç—É–Ω–≥–∞–ª–∞–≥", "code": "1228" },
      { "name": "–≠.–ë–∏–ª–≥“Ø“Ø–Ω–±–∞—è—Ä", "code": "2818" },
      { "name": "–ë.–≠–Ω—Ö–∑–∞—è–∞", "code": "3005" },
      { "name": "–ë.–≠—Ä—Ö—ç—Å", "code": "1043" },
      { "name": "–ë.–¶—ç–ª–º—ç–≥", "code": "0618" },
      { "name": "–ì.–¢—ç–º“Ø“Ø–ª—ç–Ω", "code": "0315" },
      { "name": "–°.–•–∞–ª–∏—É–Ω–∞–∞", "code": "2225" },
      { "name": "–¢.–î–∞–≤–∞–∞–±–∞–∞—Ç–∞—Ä", "code": "1117" },
      { "name": "–ê.–≠–Ω—Ö–∑—É–ª", "code": "0421" },
      { "name": "”®.–•“Ø—Å–ª—ç–Ω–±–∞—è—Ä", "code": "0376" },
      { "name": "–•.–ë–∞–¥–∞—Ä-–£—É–≥–∞–Ω", "code": "0816" },
      { "name": "–ù.–ù–∞–Ω–¥–∏–Ω-–≠—Ä–¥—ç–Ω—ç", "code": "2106" },
      { "name": "–ë.–ë–∞—Ç—Ü—ç—Ü—ç–≥", "code": "0147" }
    ];

    // LocalStorage –¥–æ—Ç–æ—Ä—Ö –º—ç–¥—ç—ç–ª—ç–ª
    let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || {};
    let scoresData = JSON.parse(localStorage.getItem('scoresData')) || {};

    function updateDashboard() {
      updateGeneralStats();
      updateStudentTable();
      updateAverageScores();
    }

    function updateGeneralStats() {
      const totalStudents = studentsData.length;
      const todayAttendance = Object.keys(attendanceData).length;
      const attendanceRate = totalStudents > 0 ? Math.round((todayAttendance / totalStudents) * 100) : 0;

      document.getElementById('totalStudents').textContent = totalStudents;
      document.getElementById('todayAttendance').textContent = todayAttendance;
      document.getElementById('attendanceRate').textContent = attendanceRate + '%';
    }

    function updateStudentTable() {
      const tbody = document.getElementById('studentTableBody');
      tbody.innerHTML = '';

      studentsData.forEach(student => {
        const row = document.createElement('tr');
        const isPresent = attendanceData[student.code];
        const score = scoresData[student.code] || 0;
        
        let scoreClass = 'score-low';
        if (score >= 80) scoreClass = 'score-high';
        else if (score >= 60) scoreClass = 'score-medium';

        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.code}</td>
          <td>${isPresent ? '‚úÖ –ò—Ä—Å—ç–Ω' : '‚ùå –ò—Ä—ç—ç–≥“Ø–π'}</td>
          <td>${isPresent ? attendanceData[student.code] : '-'}</td>
          <td class="${scoreClass}">${score}%</td>
          <td>${getStudentStatus(isPresent, score)}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateAverageScores() {
      const scores = Object.values(scoresData);
      const average = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
      const maxScore = scores.length > 0 ? Math.max(...scores) : 0;
      const minScore = scores.length > 0 ? Math.min(...scores) : 0;

      document.getElementById('averageScores').innerHTML = `
        <p><strong>–î—É–Ω–¥–∞–∂ –æ–Ω–æ–æ:</strong> ${average}%</p>
        <p><strong>–•–∞–º–≥–∏–π–Ω ”©–Ω–¥”©—Ä:</strong> ${maxScore}%</p>
        <p><strong>–•–∞–º–≥–∏–π–Ω –±–∞–≥–∞:</strong> ${minScore}%</p>
      `;
    }

    function getStudentStatus(isPresent, score) {
      if (!isPresent) return 'üî¥ –•–∏—á—ç—ç–ª–¥ –æ—Ä–æ–æ–≥“Ø–π';
      if (score >= 80) return 'üü¢ –ú–∞—à —Å–∞–π–Ω';
      if (score >= 60) return 'üü° –°–∞–π–Ω';
      return 'üî¥ –ê–Ω—Ö–∞–∞—Ä–∞–ª —Ö—ç—Ä—ç–≥—Ç—ç–π';
    }

    function exportToCSV() {
      let csvContent = "–°—É—Ä–∞–≥—á–∏–π–Ω –Ω—ç—Ä,–ö–æ–¥,–ò—Ä—Ü,–ù—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ü–∞–≥,–ë–∞—Ç–∞—Ç–≥–∞–ª—ã–Ω –æ–Ω–æ–æ,–¢”©–ª”©–≤\n";
      
      studentsData.forEach(student => {
        const isPresent = attendanceData[student.code];
        const score = scoresData[student.code] || 0;
        const loginTime = isPresent ? attendanceData[student.code] : '-';
        const status = getStudentStatus(isPresent, score);
        
        csvContent += `"${student.name}","${student.code}","${isPresent ? '–ò—Ä—Å—ç–Ω' : '–ò—Ä—ç—ç–≥“Ø–π'}","${loginTime}","${score}%","${status}"\n`;
      });

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `student_report_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function exportToJSON() {
      const reportData = {
        date: new Date().toISOString(),
        totalStudents: studentsData.length,
        attendance: attendanceData,
        scores: scoresData,
        students: studentsData.map(student => ({
          name: student.name,
          code: student.code,
          present: !!attendanceData[student.code],
          loginTime: attendanceData[student.code] || null,
          score: scoresData[student.code] || 0,
          status: getStudentStatus(!!attendanceData[student.code], scoresData[student.code] || 0)
        }))
      };

      const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `student_report_${new Date().toISOString().split('T')[0]}.json`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // 5 —Å–µ–∫—É–Ω–¥ —Ç—É—Ç–∞–º —à–∏–Ω—ç—á–ª—ç—Ö
    setInterval(updateDashboard, 5000);

    // –≠—Ö–Ω–∏–π –∞—á–∞–∞–ª–∞–ª
    updateDashboard();
  </script>
</body>
</html>
